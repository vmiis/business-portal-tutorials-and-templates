<div header>
	<div id="header__ID" top-navigation class="w3-top">
	  <div class="w3-bar w3-black w3-card-2">
		<div class='w3-hide-large h2__ID' style='color:#fff;padding:3px 0 0 20px;display: inline-block;'><b>Business Portal</b></div>
  		<a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large" style='color:#fff;font-size:26px' onclick="w3_open()"><i class="fa fa-bars"></i></a>
		<div class="w3-hide-small w3-hide-medium">
			<p class="w3-bar-item" style='margin-bottom:-20px;'><b style='font-size:145%'>Business Portal</b></p>
		    <a onclick="vm_nav_click_process('home')" class="w3-bar-item w3-button w3-padding-large">HOME</a>
		    <a onclick="vm_nav_click_process('band')" class="w3-bar-item w3-button w3-padding-large">BAND</a>
		    <a onclick="vm_nav_click_process('tour')" class="w3-bar-item w3-button w3-padding-large">TOUR</a>
		    <a onclick="vm_nav_click_process('contact')" class="w3-bar-item w3-button w3-padding-large">CONTACT</a>
		    <div class="w3-dropdown-hover">
		      <button class="w3-padding-large w3-button" title="More">MORE <i class="fa fa-caret-down"></i></button>
		      <div class="w3-dropdown-content w3-bar-block w3-card-4">
		        <a onclick="vm_nav_click_process('dev')" class="w3-bar-item w3-button">Merchandise</a>
		        <a onclick="vm_nav_click_process('dev')" class="w3-bar-item w3-button">Extras</a>
		        <a onclick="vm_nav_click_process('dev')" class="w3-bar-item w3-button">Media</a>
		      </div>
		    </div>
			<a onclick="vm_nav_click_process('about')" class="w3-bar-item w3-button w3-padding-large"><i class="fa fa-info-circle"></i> ABOUTL</a>
			<a onclick="vm_nav_click_process('portal')" class="w3-bar-item w3-button w3-padding-large"><i class="fa fa-th"></i> PORTAL</a>
			<a name=signinout onclick="vm_nav_click_process('signinout')" class="w3-bar-item w3-button w3-padding-large"></a>
	  	</div>
	 </div>
	</div>
	<div id="sidebar__ID" side-navigation class="w3-sidebar w3-bar-block w3-black w3-card-2 w3-animate-left w3-hide-large" style="display:none">
		<a href="javascript:void(0)" onclick="w3_close()" class="w3-bar-item w3-button w3-large w3-padding-16">CLOSE Ã—</a>
	  <a onclick="vm_nav_click_process('home');w3_close()" class="w3-bar-item w3-button w3-padding-large">HOME</a>
	  <a onclick="vm_nav_click_process('band');w3_close()" class="w3-bar-item w3-button w3-padding-large">BAND</a>
	  <a onclick="vm_nav_click_process('tour');w3_close()" class="w3-bar-item w3-button w3-padding-large">TOUR</a>
	  <a onclick="vm_nav_click_process('contact');w3_close()" class="w3-bar-item w3-button w3-padding-large">CONTACT</a>
	  <a onclick="vm_nav_click_process('dev');w3_close()" class="w3-bar-item w3-button w3-padding-large">MERCH</a>
	  <a onclick="vm_nav_click_process('about');w3_close()" class="w3-bar-item w3-button w3-padding-large"><i class="fa fa-info-circle"></i> ABOUT</a>
	  <a onclick="vm_nav_click_process('portal');w3_close()" class="w3-bar-item w3-button w3-padding-large"><i class="fa fa-th"></i> PORTAL</a>
	  <a name=signinout onclick="vm_nav_click_process('signinout');w3_close()" class="w3-bar-item w3-button w3-padding-large"></a>
	</div>
	<script navigation-processing>
		//-----------------------------------------
		setTimeout(function (){
			var header_height=$('#header__ID').outerHeight();
			$('#sidebar__ID').css({'margin-top':header_height+'px'});
		},1000);
		//------------------------------------
		var mySidebar = document.getElementById("sidebar__ID");
		function w3_open() {
			if (mySidebar.style.display === 'block') mySidebar.style.display = 'none';
			else 									 mySidebar.style.display = 'block';
		}
		function w3_close() {
			mySidebar.style.display = "none";
		}
		//-----------------------------------------
		var vm_nav_click_process=function(name){
			switch(name){
				case 'signinout':
					if($vm.user=='guest'){
						window.open($VmAPI.api_base+"signin.html?url="+window.location.href,"Sign In","width=600, height=600");
					}
					else{
						$VmAPI.clear_token();
						$VmAPI.request({data:{cmd:'signout'},callback:function(c){
							$vm.user="guest";
							$vm.user_id="";
							location.reload(true);
						}});
					}
					break;
				default:
					if(name=='dev'){
						$vm.alert('Under development');
					}
					else load_module(name);
					break;
			}
		}
		//-----------------------------------------
		var check_trust=function(url){
			var trust=0;
			if(url.indexOf('http://127.0.0.1')!=-1 || url.indexOf('http://localhost')!=-1){
				trust=1;
			}
			else{
				for(var i=0;i<$vm.trust_path.length;i++){
					var len=$vm.trust_path[i].length;
					if(url.indexOf($vm.trust_path[i])!==-1 && url.substring(0,len)==$vm.trust_path[i]){
						trust=1;
					}
				}
			}
			if(trust==0){
				alert("The url ("+url+") is not trusted.")
			}
			return trust;
		}
		//-----------------------------------------
		var load_module=function(name){
			if($vm.app_config.modules[name]!=undefined && $vm.app_config.modules[name].url!=undefined){
				if($vm.module_list[name]==undefined){
					$vm.module_list[name]=$vm.app_config.modules[name];
				}
			}
			var url=$vm.module_list[name].url;
			if(url.split('.').pop().split('?')[0]=='json'){
				load_panel(name)
				return;
			}
			if(url[0]=='/'){
				if($vm.hosting_path!=undefined) url=$vm.hosting_path+url;
			}
			var single_record=$vm.module_list[name].single_record;
			if(check_trust(url)==0) return;
			var op={
				//-----------------
				sys:{
					config:$vm.app_config,
					UID:name,
				},
				//-----------------
			}
			var slot=$vm.root_layout_content_slot;
			if(single_record=='1') slot=undefined;
			$vm.load_module_by_name(name,slot,op)
		};
		//---------------------------------------------
		var load_panel=function(name){
			var url=$vm.module_list[name].url;
			if(url[0]=='/'){
				if($vm.hosting_path!=undefined) url=$vm.hosting_path+url;
			}
			if(check_trust(url)==0) return;
			console.log('loading '+url);
			$.get(url,function(text){
				var text=$('<div/>').html(text).text();
				//---------------------------
				var config;
				try{ config=JSON.parse(text); }
				catch (e){ alert("Error in config file\n"+e); return; }
				//-----------------------------------------------
				var module=name+"_panel";
				if($vm.module_list[module]==undefined){
					$vm.module_list[module]={
						url:config.url,
						var:{},
					}
				}
				$vm.load_module_by_name(module,$vm.root_layout_content_slot,{
					sys:{
						config:config,
						UID:name,
					}
				})
				//-----------------------------------------------
			},'text').fail(function() {
				alert( "The file '"+url+"' doesn't exist!" );
			});
		}
		//---------------------------------------------
		var show_sign=function(){
			if($vm.user=='guest'){
				$('a[name=signinout]').html('<i class="fa fa-user"></i> SIGN IN')
				$('#username__ID').text('');
			}
			else{
				$('a[name=signinout]').html('<i class="fa fa-user"></i> SIGN OUT')
				$('#username__ID').text('Signed in as '+ $vm.user);
			}
		}
		show_sign();
		//---------------------------------------------
	</script>
	<style>
		.h2__ID{
			font: 180% Arial;
			display: inline-block;
			margin: 10px 0 5px 10px;
		}
	</style>
</div>
